# üåç Internationalization (i18n) with next-intl

Multi-language support using next-intl for server and client components with locale switching and translation management.

## Overview

This project uses **next-intl** for enterprise-grade internationalization with support for multiple languages, RTL, and locale-based routing.

## Features

‚úÖ Multiple languages (English, Arabic, Kurdish)  
‚úÖ Server & client component support  
‚úÖ Locale-based routing  
‚úÖ Cookie-based persistence  
‚úÖ RTL support (Arabic)  
‚úÖ Type-safe translations  
‚úÖ Locale switcher component  
‚úÖ Easy to add new languages  

## Supported Languages

| Code | Language | Direction |
|------|----------|-----------|
| `en` | English | LTR |
| `ar` | Arabic | RTL |
| `ckb` | Kurdish (Sorani) | RTL |

## Configuration

### i18n Config (`src/i18n/config.ts`)

```typescript
export const locales = ["ckb", "en", "ar"] as const;
export type Locale = (typeof locales)[number];

export const defaultLocale: Locale = "en";

export const localeNames: Record<Locale, string> = {
  en: "English",
  ar: "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",
  ckb: "⁄©Ÿàÿ±ÿØ€å",
};
```

### Middleware (`src/middleware.ts`)

```typescript
import createMiddleware from 'next-intl/middleware';
import { locales, defaultLocale } from './i18n/config';

export default createMiddleware({
  locales,
  defaultLocale,
  localePrefix: 'as-needed', // /en/page ‚Üí /page for default locale
});

export const config = {
  matcher: ['/((?!api|_next|.*\\..*).*)'],
};
```

## Translation Files

### File Structure

```
src/messages/
‚îú‚îÄ‚îÄ en.json      # English
‚îú‚îÄ‚îÄ ar.json      # Arabic
‚îî‚îÄ‚îÄ ckb.json     # Kurdish
```

### English (`src/messages/en.json`)

```json
{
  "common": {
    "welcome": "Welcome",
    "hello": "Hello, {name}!",
    "logout": "Logout",
    "loading": "Loading..."
  },
  "navigation": {
    "home": "Home",
    "dashboard": "Dashboard",
    "profile": "Profile"
  },
  "errors": {
    "not_found": "Page not found",
    "server_error": "Something went wrong"
  }
}
```

### Arabic (`src/messages/ar.json`)

```json
{
  "common": {
    "welcome": "ÿ£ŸáŸÑÿßŸã Ÿàÿ≥ŸáŸÑÿßŸã",
    "hello": "ŸÖÿ±ÿ≠ÿ®ÿßŸãÿå {name}!",
    "logout": "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",
    "loading": "ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ..."
  },
  "navigation": {
    "home": "ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©",
    "dashboard": "ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ",
    "profile": "ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä"
  }
}
```

## Usage

### Server Components

```typescript
import { useTranslations } from 'next-intl';

export default function HomePage() {
  const t = useTranslations('common');

  return (
    <div>
      <h1>{t('welcome')}</h1>
      <p>{t('hello', { name: 'John' })}</p>
    </div>
  );
}
```

### Client Components

```typescript
'use client';

import { useTranslations } from 'next-intl';

export function WelcomeMessage() {
  const t = useTranslations('common');

  return <h1>{t('welcome')}</h1>;
}
```

### With Parameters

```typescript
const t = useTranslations('common');

// Simple interpolation
t('hello', { name: 'John' });  // "Hello, John!"

// Plurals
t('items', { count: 5 });  // "5 items" or "1 item"

// Rich text
t.rich('message', {
  strong: (chunks) => <strong>{chunks}</strong>,
});
```

### Get Current Locale

```typescript
import { useLocale } from 'next-intl';

export function MyComponent() {
  const locale = useLocale();  // 'en', 'ar', or 'ckb'

  return <div>Current locale: {locale}</div>;
}
```

## Locale Switcher Component

Located in `src/components/layout/locale-switcher.tsx`:

```typescript
'use client';

import { useLocale } from 'next-intl';
import { useRouter, usePathname } from 'next/navigation';
import { locales, localeNames } from '@/i18n/config';

export function LocaleSwitcher() {
  const locale = useLocale();
  const router = useRouter();
  const pathname = usePathname();

  function switchLocale(newLocale: string) {
    // Remove current locale from path
    const segments = pathname.split('/');
    if (locales.includes(segments[1] as any)) {
      segments[1] = newLocale;
    } else {
      segments.splice(1, 0, newLocale);
    }

    const newPath = segments.join('/');
    router.push(newPath);
  }

  return (
    <select value={locale} onChange={(e) => switchLocale(e.target.value)}>
      {locales.map((loc) => (
        <option key={loc} value={loc}>
          {localeNames[loc]}
        </option>
      ))}
    </select>
  );
}
```

## Adding a New Language

### 1. Update Config

```typescript
// src/i18n/config.ts
export const locales = ["ckb", "en", "ar", "fr"] as const;

export const localeNames: Record<Locale, string> = {
  // ... existing
  fr: "Fran√ßais",
};
```

### 2. Create Translation File

```json
// src/messages/fr.json
{
  "common": {
    "welcome": "Bienvenue",
    "hello": "Bonjour, {name}!",
    "logout": "D√©connexion",
    "loading": "Chargement..."
  }
}
```

### 3. Test

Visit `/fr` to see French version.

## RTL Support

### Automatic Direction

next-intl handles RTL automatically based on locale:

```typescript
// In layout
import { useLocale } from 'next-intl';

export default function RootLayout({ children }) {
  const locale = useLocale();
  const direction = locale === 'ar' || locale === 'ckb' ? 'rtl' : 'ltr';

  return (
    <html lang={locale} dir={direction}>
      <body>{children}</body>
    </html>
  );
}
```

### RTL-Aware Styles

```css
/* Tailwind with RTL */
.element {
  @apply ms-4;  /* margin-start (left in LTR, right in RTL) */
  @apply me-4;  /* margin-end (right in LTR, left in RTL) */
}
```

## Type-Safe Translations

### Generate Types

```typescript
// types/translations.ts
import en from '@/messages/en.json';

type Messages = typeof en;

declare global {
  interface IntlMessages extends Messages {}
}
```

### Usage with Types

```typescript
const t = useTranslations('common');

// TypeScript knows these keys exist
t('welcome');  // ‚úÖ
t('invalid');  // ‚ùå TypeScript error
```

## Translation Best Practices

### 1. Namespace Translations

```json
{
  "auth": {
    "login": "Login",
    "signup": "Sign Up"
  },
  "dashboard": {
    "welcome": "Welcome to Dashboard"
  }
}
```

```typescript
const t = useTranslations('auth');
t('login');  // "Login"
```

### 2. Use Interpolation

```json
{
  "greeting": "Hello, {name}! You have {count} messages."
}
```

```typescript
t('greeting', { name: 'John', count: 5 });
```

### 3. Handle Plurals

```json
{
  "items": "{count, plural, =0 {No items} =1 {One item} other {{count} items}}"
}
```

```typescript
t('items', { count: 0 });  // "No items"
t('items', { count: 1 });  // "One item"
t('items', { count: 5 });  // "5 items"
```

### 4. Date and Time Formatting

```typescript
import { useFormatter } from 'next-intl';

function MyComponent() {
  const format = useFormatter();

  const date = new Date();
  
  return (
    <div>
      {format.dateTime(date, {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
      })}
    </div>
  );
}
```

### 5. Number Formatting

```typescript
const format = useFormatter();

format.number(1234.56, {
  style: 'currency',
  currency: 'USD',
});  // "$1,234.56"
```

## URL Structure

With `localePrefix: 'as-needed'`:

- `/` ‚Üí Default locale (English)
- `/ar` ‚Üí Arabic
- `/ckb` ‚Üí Kurdish
- `/dashboard` ‚Üí English dashboard
- `/ar/dashboard` ‚Üí Arabic dashboard

With `localePrefix: 'always'`:

- `/en` ‚Üí English
- `/ar` ‚Üí Arabic
- `/ckb` ‚Üí Kurdish
- `/en/dashboard` ‚Üí English dashboard

## Server-Side Translation Loading

```typescript
// app/[locale]/layout.tsx
import { NextIntlClientProvider } from 'next-intl';
import { getMessages } from 'next-intl/server';

export default async function LocaleLayout({
  children,
  params: { locale },
}: {
  children: React.ReactNode;
  params: { locale: string };
}) {
  const messages = await getMessages();

  return (
    <NextIntlClientProvider locale={locale} messages={messages}>
      {children}
    </NextIntlClientProvider>
  );
}
```

## Testing Translations

### Component Test

```typescript
import { NextIntlClientProvider } from 'next-intl';
import messages from '@/messages/en.json';

function renderWithIntl(component: React.ReactNode) {
  return render(
    <NextIntlClientProvider locale="en" messages={messages}>
      {component}
    </NextIntlClientProvider>
  );
}
```

## Common Issues

### Missing Translation

```typescript
// Returns key if translation missing
t('missing.key');  // "missing.key"

// Provide fallback
t('missing.key', {}, { fallback: 'Default text' });
```

### Locale Not Persisting

Check middleware matcher excludes API routes:

```typescript
export const config = {
  matcher: ['/((?!api|_next|.*\\..*).*)'],
};
```

## Resources

- [next-intl Documentation](https://next-intl-docs.vercel.app/)
- [ICU Message Format](https://formatjs.io/docs/core-concepts/icu-syntax/)
- [RTL Styling Guide](https://rtlstyling.com/)

---

[‚Üê Back to Main README](../README.md)
